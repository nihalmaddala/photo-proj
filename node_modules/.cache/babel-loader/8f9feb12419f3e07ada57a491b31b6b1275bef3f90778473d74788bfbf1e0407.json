{"ast":null,"code":"import { buildHeaders } from \"./internal/headers.mjs\";\nimport * as Errors from \"./error.mjs\";\nimport { isObj, readEnv } from \"./internal/utils.mjs\";\nimport { OpenAI } from \"./client.mjs\";\n/** API Client for interfacing with the Azure OpenAI API. */\nexport class AzureOpenAI extends OpenAI {\n  /**\n   * API Client for interfacing with the Azure OpenAI API.\n   *\n   * @param {string | undefined} [opts.apiVersion=process.env['OPENAI_API_VERSION'] ?? undefined]\n   * @param {string | undefined} [opts.endpoint=process.env['AZURE_OPENAI_ENDPOINT'] ?? undefined] - Your Azure endpoint, including the resource, e.g. `https://example-resource.azure.openai.com/`\n   * @param {string | undefined} [opts.apiKey=process.env['AZURE_OPENAI_API_KEY'] ?? undefined]\n   * @param {string | undefined} opts.deployment - A model deployment, if given, sets the base client URL to include `/deployments/{deployment}`.\n   * @param {string | null | undefined} [opts.organization=process.env['OPENAI_ORG_ID'] ?? null]\n   * @param {string} [opts.baseURL=process.env['OPENAI_BASE_URL']] - Sets the base URL for the API, e.g. `https://example-resource.azure.openai.com/openai/`.\n   * @param {number} [opts.timeout=10 minutes] - The maximum amount of time (in milliseconds) the client will wait for a response before timing out.\n   * @param {number} [opts.httpAgent] - An HTTP agent used to manage HTTP(s) connections.\n   * @param {Fetch} [opts.fetch] - Specify a custom `fetch` function implementation.\n   * @param {number} [opts.maxRetries=2] - The maximum number of times the client will retry a request.\n   * @param {Headers} opts.defaultHeaders - Default headers to include with every request to the API.\n   * @param {DefaultQuery} opts.defaultQuery - Default query parameters to include with every request to the API.\n   * @param {boolean} [opts.dangerouslyAllowBrowser=false] - By default, client-side use of this library is not allowed, as it risks exposing your secret API credentials to attackers.\n   */\n  constructor({\n    baseURL = readEnv('OPENAI_BASE_URL'),\n    apiKey = readEnv('AZURE_OPENAI_API_KEY'),\n    apiVersion = readEnv('OPENAI_API_VERSION'),\n    endpoint,\n    deployment,\n    azureADTokenProvider,\n    dangerouslyAllowBrowser,\n    ...opts\n  } = {}) {\n    if (!apiVersion) {\n      throw new Errors.OpenAIError(\"The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).\");\n    }\n    if (typeof azureADTokenProvider === 'function') {\n      dangerouslyAllowBrowser = true;\n    }\n    if (!azureADTokenProvider && !apiKey) {\n      throw new Errors.OpenAIError('Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.');\n    }\n    if (azureADTokenProvider && apiKey) {\n      throw new Errors.OpenAIError('The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.');\n    }\n    opts.defaultQuery = {\n      ...opts.defaultQuery,\n      'api-version': apiVersion\n    };\n    if (!baseURL) {\n      if (!endpoint) {\n        endpoint = process.env['AZURE_OPENAI_ENDPOINT'];\n      }\n      if (!endpoint) {\n        throw new Errors.OpenAIError('Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable');\n      }\n      baseURL = `${endpoint}/openai`;\n    } else {\n      if (endpoint) {\n        throw new Errors.OpenAIError('baseURL and endpoint are mutually exclusive');\n      }\n    }\n    super({\n      apiKey: azureADTokenProvider ?? apiKey,\n      baseURL,\n      ...opts,\n      ...(dangerouslyAllowBrowser !== undefined ? {\n        dangerouslyAllowBrowser\n      } : {})\n    });\n    this.apiVersion = '';\n    this.apiVersion = apiVersion;\n    this.deploymentName = deployment;\n  }\n  async buildRequest(options, props = {}) {\n    if (_deployments_endpoints.has(options.path) && options.method === 'post' && options.body !== undefined) {\n      if (!isObj(options.body)) {\n        throw new Error('Expected request body to be an object');\n      }\n      const model = this.deploymentName || options.body['model'] || options.__metadata?.['model'];\n      if (model !== undefined && !this.baseURL.includes('/deployments')) {\n        options.path = `/deployments/${model}${options.path}`;\n      }\n    }\n    return super.buildRequest(options, props);\n  }\n  async authHeaders(opts) {\n    if (typeof this._options.apiKey === 'string') {\n      return buildHeaders([{\n        'api-key': this.apiKey\n      }]);\n    }\n    return super.authHeaders(opts);\n  }\n}\nconst _deployments_endpoints = new Set(['/completions', '/chat/completions', '/embeddings', '/audio/transcriptions', '/audio/translations', '/audio/speech', '/images/generations', '/batches', '/images/edits']);","map":{"version":3,"names":["buildHeaders","Errors","isObj","readEnv","OpenAI","AzureOpenAI","constructor","baseURL","apiKey","apiVersion","endpoint","deployment","azureADTokenProvider","dangerouslyAllowBrowser","opts","OpenAIError","defaultQuery","process","env","undefined","deploymentName","buildRequest","options","props","_deployments_endpoints","has","path","method","body","Error","model","__metadata","includes","authHeaders","_options","Set"],"sources":["/Users/nihalmaddala/photo-proj/node_modules/openai/src/azure.ts"],"sourcesContent":["import type { RequestInit } from './internal/builtin-types';\nimport type { NullableHeaders } from './internal/headers';\nimport { buildHeaders } from './internal/headers';\nimport * as Errors from './error';\nimport { FinalRequestOptions } from './internal/request-options';\nimport { isObj, readEnv } from './internal/utils';\nimport { ClientOptions, OpenAI } from './client';\n\n/** API Client for interfacing with the Azure OpenAI API. */\nexport interface AzureClientOptions extends ClientOptions {\n  /**\n   * Defaults to process.env['OPENAI_API_VERSION'].\n   */\n  apiVersion?: string | undefined;\n\n  /**\n   * Your Azure endpoint, including the resource, e.g. `https://example-resource.azure.openai.com/`\n   */\n  endpoint?: string | undefined;\n\n  /**\n   * A model deployment, if given, sets the base client URL to include `/deployments/{deployment}`.\n   * Note: this means you won't be able to use non-deployment endpoints. Not supported with Assistants APIs.\n   */\n  deployment?: string | undefined;\n\n  /**\n   * Defaults to process.env['AZURE_OPENAI_API_KEY'].\n   */\n  apiKey?: string | undefined;\n\n  /**\n   * A function that returns an access token for Microsoft Entra (formerly known as Azure Active Directory),\n   * which will be invoked on every request.\n   */\n  azureADTokenProvider?: (() => Promise<string>) | undefined;\n}\n\n/** API Client for interfacing with the Azure OpenAI API. */\nexport class AzureOpenAI extends OpenAI {\n  deploymentName: string | undefined;\n  apiVersion: string = '';\n\n  /**\n   * API Client for interfacing with the Azure OpenAI API.\n   *\n   * @param {string | undefined} [opts.apiVersion=process.env['OPENAI_API_VERSION'] ?? undefined]\n   * @param {string | undefined} [opts.endpoint=process.env['AZURE_OPENAI_ENDPOINT'] ?? undefined] - Your Azure endpoint, including the resource, e.g. `https://example-resource.azure.openai.com/`\n   * @param {string | undefined} [opts.apiKey=process.env['AZURE_OPENAI_API_KEY'] ?? undefined]\n   * @param {string | undefined} opts.deployment - A model deployment, if given, sets the base client URL to include `/deployments/{deployment}`.\n   * @param {string | null | undefined} [opts.organization=process.env['OPENAI_ORG_ID'] ?? null]\n   * @param {string} [opts.baseURL=process.env['OPENAI_BASE_URL']] - Sets the base URL for the API, e.g. `https://example-resource.azure.openai.com/openai/`.\n   * @param {number} [opts.timeout=10 minutes] - The maximum amount of time (in milliseconds) the client will wait for a response before timing out.\n   * @param {number} [opts.httpAgent] - An HTTP agent used to manage HTTP(s) connections.\n   * @param {Fetch} [opts.fetch] - Specify a custom `fetch` function implementation.\n   * @param {number} [opts.maxRetries=2] - The maximum number of times the client will retry a request.\n   * @param {Headers} opts.defaultHeaders - Default headers to include with every request to the API.\n   * @param {DefaultQuery} opts.defaultQuery - Default query parameters to include with every request to the API.\n   * @param {boolean} [opts.dangerouslyAllowBrowser=false] - By default, client-side use of this library is not allowed, as it risks exposing your secret API credentials to attackers.\n   */\n  constructor({\n    baseURL = readEnv('OPENAI_BASE_URL'),\n    apiKey = readEnv('AZURE_OPENAI_API_KEY'),\n    apiVersion = readEnv('OPENAI_API_VERSION'),\n    endpoint,\n    deployment,\n    azureADTokenProvider,\n    dangerouslyAllowBrowser,\n    ...opts\n  }: AzureClientOptions = {}) {\n    if (!apiVersion) {\n      throw new Errors.OpenAIError(\n        \"The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).\",\n      );\n    }\n\n    if (typeof azureADTokenProvider === 'function') {\n      dangerouslyAllowBrowser = true;\n    }\n\n    if (!azureADTokenProvider && !apiKey) {\n      throw new Errors.OpenAIError(\n        'Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.',\n      );\n    }\n\n    if (azureADTokenProvider && apiKey) {\n      throw new Errors.OpenAIError(\n        'The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.',\n      );\n    }\n\n    opts.defaultQuery = { ...opts.defaultQuery, 'api-version': apiVersion };\n\n    if (!baseURL) {\n      if (!endpoint) {\n        endpoint = process.env['AZURE_OPENAI_ENDPOINT'];\n      }\n\n      if (!endpoint) {\n        throw new Errors.OpenAIError(\n          'Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable',\n        );\n      }\n\n      baseURL = `${endpoint}/openai`;\n    } else {\n      if (endpoint) {\n        throw new Errors.OpenAIError('baseURL and endpoint are mutually exclusive');\n      }\n    }\n\n    super({\n      apiKey: azureADTokenProvider ?? apiKey,\n      baseURL,\n      ...opts,\n      ...(dangerouslyAllowBrowser !== undefined ? { dangerouslyAllowBrowser } : {}),\n    });\n\n    this.apiVersion = apiVersion;\n    this.deploymentName = deployment;\n  }\n\n  override async buildRequest(\n    options: FinalRequestOptions,\n    props: { retryCount?: number } = {},\n  ): Promise<{ req: RequestInit & { headers: Headers }; url: string; timeout: number }> {\n    if (_deployments_endpoints.has(options.path) && options.method === 'post' && options.body !== undefined) {\n      if (!isObj(options.body)) {\n        throw new Error('Expected request body to be an object');\n      }\n      const model = this.deploymentName || options.body['model'] || options.__metadata?.['model'];\n      if (model !== undefined && !this.baseURL.includes('/deployments')) {\n        options.path = `/deployments/${model}${options.path}`;\n      }\n    }\n    return super.buildRequest(options, props);\n  }\n\n  protected override async authHeaders(opts: FinalRequestOptions): Promise<NullableHeaders | undefined> {\n    if (typeof this._options.apiKey === 'string') {\n      return buildHeaders([{ 'api-key': this.apiKey }]);\n    }\n    return super.authHeaders(opts);\n  }\n}\n\nconst _deployments_endpoints = new Set([\n  '/completions',\n  '/chat/completions',\n  '/embeddings',\n  '/audio/transcriptions',\n  '/audio/translations',\n  '/audio/speech',\n  '/images/generations',\n  '/batches',\n  '/images/edits',\n]);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}